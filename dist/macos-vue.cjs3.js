"use strict";var g=Object.defineProperty;var m=(o,t,e)=>t in o?g(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var i=(o,t,e)=>(m(o,typeof t!="symbol"?t+"":t,e),e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const y=require("ansi-to-html"),w=require("vue"),p=w.reactive({extensions:{}}),x=o=>{o!==void 0&&Object.assign(p.extensions,o)},b=new y;class B{constructor(t,e){i(this,"cwd",[]);i(this,"prompt","%");i(this,"commands",{});i(this,"buffer","");i(this,"typingBuffer","");i(this,"dir",{});i(this,"user","user");i(this,"host","host");i(this,"pos",0);i(this,"index");i(this,"history",[]);i(this,"historyIndex",0);i(this,"restore",()=>{const t=JSON.parse(localStorage.getItem("terminal."+this.index)??"{}");t!==void 0&&(this.buffer=t.buffer??this.getPrompt(),this.typingBuffer=t.typingBuffer??"",this.history=t.history??[],this.historyIndex=t.historyIndex??0)});i(this,"save",()=>{localStorage.setItem("terminal."+this.index,JSON.stringify({buffer:this.buffer,typingBuffer:this.typingBuffer}))});i(this,"setTerminal",t=>{this.dir=t.dir,this.user=t.user,this.host=t.host});i(this,"setUser",t=>{this.user=t});i(this,"goHistory",t=>{const e=this.historyIndex+t;e>=0&&e<this.history.length&&(this.typingBuffer=this.history[e],this.historyIndex=e)});i(this,"getCwd",()=>[...this.cwd]);i(this,"setCwd",t=>{this.cwd=t});i(this,"pushCwd",t=>{this.cwd.push(t)});i(this,"getPrompt",()=>this.user+"@"+this.host+" "+this.getcwd()+this.prompt+" ");i(this,"findDir",(t,e)=>{if(typeof t=="string"||!e.length)return t;let s=[...e];const h=s.shift()??"";return t[h]===void 0?{}:this.findDir(t[h],s)});i(this,"newline",()=>{this.buffer+=this.typingBuffer+`
`,this.updatePos()});i(this,"updatePos",()=>{this.pos=this.buffer.length});i(this,"result",t=>{this.buffer+=t+this.getPrompt(),this.save(),this.updatePos()});i(this,"commandNotFound",t=>{this.result("Command "+t+` not found.
`)});i(this,"keypress",t=>{this.typingBuffer+=t});i(this,"backspace",()=>{this.typingBuffer.length>0&&(this.typingBuffer=this.typingBuffer.substring(0,this.typingBuffer.length-1))});i(this,"ctrlC",()=>{this.newline(),this.result(""),this.typingBuffer=""});i(this,"exec",async()=>{this.newline(),this.historyIndex=this.history.push(this.typingBuffer),console.log(this.history,this.historyIndex),this.typingBuffer==""&&this.result("");const t=String(this.typingBuffer).replace(/\\ /g,"ยบ").split(" ").map(s=>s.replace(/ยบ/g," "));this.typingBuffer="";const e=Object.entries(this.commands).find((s,h)=>s[0]===t[0]);if(!e)this.commandNotFound(t[0]);else{const s=await e[1][0](t.length>1?t.slice(1):[]);this.result(s)}});i(this,"help",t=>{if(t.length){const e=Object.entries(this.commands).find((s,h)=>s[0]===t[0]);return e?e[0]+" "+e[1][1]+" : "+e[1][2]+`
`:"Command "+t[0]+` not found.
`}return"Available commands: "+Object.keys(this.commands).sort((e,s)=>e[0]<s[0]?-1:e[0]===s[0]?0:1).join(", ")+"\nUse `help command` for more help\n"});i(this,"clear",()=>(this.buffer="",`
`));i(this,"ls",t=>{let e=!1;t[0]==="-l"&&(e=!0,t.shift());let s=[],h="",n=[],f={};const a=t.length>0;for(;;){n=this.getCwd(),console.log("ndir=",n),t.length&&t[0].split("/").forEach(r=>{r===".."&&n.length>0?n.pop():r!=="."&&n.push(r)}),f=this.findDir(this.dir,n);let u=[];if(f!==void 0)if(typeof f=="string"){let r="";e&&(r+="-r--r----- "),r+=t[0],s.push(r)}else u=Object.entries(f).sort((r,d)=>r[0]<d[0]?-1:r[0]===d[0]?0:1).map((r,d)=>{let l="";const c=typeof r[1]=="string";return e&&(l+=(c?"-r--r-----":"dr-xr-x---")+" ",l+=" "+(c?1:2)+" "),l+=c?r[0]:b.toHtml("\x1B[31m"+r[0]+"\x1B[0m"),l}),u.length&&(h+=(a?t[0]+`:
`:"")+u.join(e?`
`:" ")+`

`);if(t.length>1)t.shift();else break}return(s.length?s.join(e?`
`:" ")+`

`:"")+h});i(this,"pwd",()=>this.cwd.reduce((t,e)=>(t?t+"/":"")+e,"/home/"+this.user)+`
`);i(this,"getcwd",()=>{let t=this.getCwd();return t.length?t.pop()??"~":"~"});i(this,"cd",t=>{if(!t.length)return this.setCwd([]),`
`;let e=this.getCwd();return t[0].split("/").forEach(h=>{h===".."&&e.length>0?e.pop():h!=="."&&e.push(h)}),this.findDir(this.dir,e)===void 0?`Directory not found.
`:(this.setCwd(e),`
`)});i(this,"readContent",async t=>await fetch(t).then(async s=>await s.text().then(n=>n.replace(/\r?\n/g,"<br/>").replace(/ /g,"&nbsp;")).catch(n=>n)).catch(s=>s));i(this,"cat",async t=>{if(!t.length)return`Missing filename.
`;let e=this.getCwd();t[0].split("/").forEach(n=>{n===".."&&e.length>0?e.pop():n!=="."&&e.push(n)});const s=this.findDir(this.dir,e);return typeof s!="string"?`File not found.
`:await this.readContent(s).then(n=>n).catch(n=>n)+`
`});this.index=e,this.setTerminal(t),this.cwd=[],this.prompt="%",this.commands={help:[this.help,"[command]","help with commands"],ls:[this.ls,"[-l][dir]","list files in directory"],pwd:[this.pwd,"","show current directory"],cd:[this.cd,"[dir]","change directory"],cat:[this.cat,"[filename]","dump a text file"],clear:[this.clear,"","clear terminal"],...p.extensions},this.buffer=this.getPrompt(),this.typingBuffer="",this.restore(),this.updatePos()}}exports.extendCommands=x;exports.terminal=B;exports.terminalStore=p;
