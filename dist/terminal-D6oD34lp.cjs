"use strict";var w=Object.defineProperty;var y=(l,t,e)=>t in l?w(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var n=(l,t,e)=>(y(l,typeof t!="symbol"?t+"":t,e),e);const b=require("ansi-to-html"),C=require("vue");require("./macos-vue.cjs2.js");const u=C.reactive({extensions:{}}),a=l=>{Object.assign(u.extensions,l)},x=new b;class m{constructor(t){n(this,"setTerminal",t=>{this.dir=t.dir??{},this.user=t.user??"user",this.host=t.host??"host"});n(this,"setUser",t=>{this.user=t});n(this,"getCwd",()=>[...this.cwd]);n(this,"setCwd",t=>{this.cwd=t});n(this,"pushCwd",t=>{this.cwd.push(t)});n(this,"getPrompt",()=>this.user+"@"+this.host+" "+this.getcwd()+this.prompt+" ");n(this,"findDir",(t,e)=>{if(!e.length)return t;let i=[...e];const h=i.shift();return t[h]===void 0?-1:this.findDir(t[h],i)});n(this,"newline",()=>{this.buffer+=this.typingBuffer+`
`,this.updatePos()});n(this,"updatePos",()=>{this.pos=this.buffer.length});n(this,"result",t=>{this.buffer+=t+this.getPrompt(),this.updatePos()});n(this,"commandNotFound",t=>{this.result("Command "+t+` not found.
`)});n(this,"keypress",t=>{this.typingBuffer+=t});n(this,"backspace",()=>{this.typingBuffer.length>0&&(this.typingBuffer=this.typingBuffer.substring(0,this.typingBuffer.length-1))});n(this,"ctrlC",()=>{this.newline(),this.result(""),this.typingBuffer=""});n(this,"exec",async()=>{this.newline(),this.typingBuffer==""&&this.result("");const t=String(this.typingBuffer).replace(/\\ /g,"ยบ").split(" ").map(i=>i.replace(/ยบ/g," "));this.typingBuffer="";const e=Object.entries(this.commands).find((i,h)=>i[0]===t[0]);if(!e)this.commandNotFound(t[0]);else{const i=await e[1][0](t.length>1?t.slice(1):[]);this.result(i)}});n(this,"help",t=>{if(t.length){const e=Object.entries(this.commands).find((i,h)=>i[0]===t[0]);return e?e[0]+" "+e[1][1]+" : "+e[1][2]+`
`:"Command "+t[0]+` not found.
`}return"Available commands: "+Object.keys(this.commands).sort((e,i)=>e[0]<i[0]?-1:e[0]===i[0]?0:1).join(", ")+"\nUse `help command` for more help\n"});n(this,"ls",t=>{let e=!1;t[0]==="-l"&&(e=!0,t.shift());let i=[],h="",s=[],o=[];const g=t.length>0;for(;;){s=this.getCwd(),t.length&&t[0].split("/").forEach(r=>{s.push(r)}),o=this.findDir(this.dir,s);let c=[];if(typeof o=="string"){let r="";e&&(r+="-r--r----- "),r+=t[0],i.push(r)}else c=Object.entries(o).sort((r,f)=>r[0]<f[0]?-1:r[0]===f[0]?0:1).map((r,f)=>{let d="";const p=typeof r[1]=="string";return e&&(d+=(p?"-r--r-----":"dr-xr-x---")+" "),d+=p?r[0]:x.toHtml("\x1B[35m"+r[0]+"\x1B[0m"),d}),c.length&&(h+=(g>0?t[0]+`:
`:"")+c.join(e?`
`:" ")+`

`);if(t.length>1)t.shift();else break}return(i.length?i.join(e?`
`:" ")+`

`:"")+h});n(this,"pwd",()=>this.cwd.reduce((t,e)=>(t?t+"/":"")+e,"/home/"+this.user)+`
`);n(this,"getcwd",()=>{let t=this.getCwd();return t.length?t.pop():"~"});n(this,"cd",t=>{if(!t.length)return this.setCwd([]),`
`;let e=this.getCwd();if(t[0]===".."&&e.length>0)e.pop();else{if(t[0]===".."||t[0]===".")return`
`;t[0].split("/").forEach(h=>{e.push(h)})}return this.findDir(this.dir,e)===-1?`Directory not found.
`:(this.setCwd(e),`
`)});n(this,"readContent",async t=>await fetch(t).then(async i=>await i.text().then(s=>s.replace(/\r?\n/g,"<br/>").replace(/ /g,"&nbsp;")).catch(s=>s)).catch(i=>i));n(this,"cat",async t=>{if(!t.length)return`Missing filename.
`;let e=this.getCwd();if(t[0].split("/").forEach(s=>{e.push(s)}),this.findDir(this.dir,e)===-1)return`File not found.
`;const i="/files/"+e.join("/");return await this.readContent(i).then(s=>s).catch(s=>s)+`
`});this.setTerminal(t),this.cwd=[],this.prompt="%",this.commands={help:[this.help,"[command]","help with commands"],ls:[this.ls,"[-l][dir]","list files in directory"],pwd:[this.pwd,"","show current directory"],cd:[this.cd,"[dir]","change directory"],cat:[this.cat,"[filename]","dump a text file"],...u.extensions},this.buffer=this.getPrompt(),this.updatePos(),this.typingBuffer=""}}const j=Object.freeze(Object.defineProperty({__proto__:null,extendCommands:a,terminal:m,terminalStore:u},Symbol.toStringTag,{value:"Module"}));exports.extendCommands=a;exports.terminal=m;exports.terminal$1=j;exports.terminalStore=u;
