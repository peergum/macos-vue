"use strict";var y=Object.defineProperty;var b=(o,t,e)=>t in o?y(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var i=(o,t,e)=>(b(o,typeof t!="symbol"?t+"":t,e),e);const C=require("ansi-to-html"),B=require("vue"),f=B.reactive({extensions:{}}),a=o=>{o!==void 0&&Object.assign(f.extensions,o)},j=new C;class m{constructor(t){i(this,"cwd",[]);i(this,"prompt","%");i(this,"commands",{});i(this,"buffer","");i(this,"typingBuffer","");i(this,"dir",{});i(this,"user","user");i(this,"host","host");i(this,"pos",0);i(this,"setTerminal",t=>{this.dir=t.dir,this.user=t.user,this.host=t.host});i(this,"setUser",t=>{this.user=t});i(this,"getCwd",()=>[...this.cwd]);i(this,"setCwd",t=>{this.cwd=t});i(this,"pushCwd",t=>{this.cwd.push(t)});i(this,"getPrompt",()=>this.user+"@"+this.host+" "+this.getcwd()+this.prompt+" ");i(this,"findDir",(t,e)=>{if(typeof t=="string")return{};if(!e.length)return t;let n=[...e];const h=n.shift()??"";return this.findDir(t[h],n)});i(this,"newline",()=>{this.buffer+=this.typingBuffer+`
`,this.updatePos()});i(this,"updatePos",()=>{this.pos=this.buffer.length});i(this,"result",t=>{this.buffer+=t+this.getPrompt(),this.updatePos()});i(this,"commandNotFound",t=>{this.result("Command "+t+` not found.
`)});i(this,"keypress",t=>{this.typingBuffer+=t});i(this,"backspace",()=>{this.typingBuffer.length>0&&(this.typingBuffer=this.typingBuffer.substring(0,this.typingBuffer.length-1))});i(this,"ctrlC",()=>{this.newline(),this.result(""),this.typingBuffer=""});i(this,"exec",async()=>{this.newline(),this.typingBuffer==""&&this.result("");const t=String(this.typingBuffer).replace(/\\ /g,"ยบ").split(" ").map(n=>n.replace(/ยบ/g," "));this.typingBuffer="";const e=Object.entries(this.commands).find((n,h)=>n[0]===t[0]);if(!e)this.commandNotFound(t[0]);else{const n=await e[1][0](t.length>1?t.slice(1):[]);this.result(n)}});i(this,"help",t=>{if(t.length){const e=Object.entries(this.commands).find((n,h)=>n[0]===t[0]);return e?e[0]+" "+e[1][1]+" : "+e[1][2]+`
`:"Command "+t[0]+` not found.
`}return"Available commands: "+Object.keys(this.commands).sort((e,n)=>e[0]<n[0]?-1:e[0]===n[0]?0:1).join(", ")+"\nUse `help command` for more help\n"});i(this,"ls",t=>{let e=!1;t[0]==="-l"&&(e=!0,t.shift());let n=[],h="",s=[],l={};const g=t.length>0;for(;;){s=this.getCwd(),t.length&&t[0].split("/").forEach(r=>{s.push(r)}),l=this.findDir(this.dir,s);let u=[];if(typeof l=="string"){let r="";e&&(r+="-r--r----- "),r+=t[0],n.push(r)}else u=Object.entries(l).sort((r,d)=>r[0]<d[0]?-1:r[0]===d[0]?0:1).map((r,d)=>{let c="";const p=typeof r[1]=="string";if(e){c+=(p?"-r--r-----":"dr-xr-x---")+" ";const w=(p?1:2)+Object.keys(l).length;c+=" "+w+" "}return c+=p?r[0]:j.toHtml("\x1B[35m"+r[0]+"\x1B[0m"),c}),u.length&&(h+=(g?t[0]+`:
`:"")+u.join(e?`
`:" ")+`

`);if(t.length>1)t.shift();else break}return(n.length?n.join(e?`
`:" ")+`

`:"")+h});i(this,"pwd",()=>this.cwd.reduce((t,e)=>(t?t+"/":"")+e,"/home/"+this.user)+`
`);i(this,"getcwd",()=>{let t=this.getCwd();return t.length?t.pop()??"~":"~"});i(this,"cd",t=>{if(!t.length)return this.setCwd([]),`
`;let e=this.getCwd();if(t[0]===".."&&e.length>0)e.pop();else{if(t[0]===".."||t[0]===".")return`
`;t[0].split("/").forEach(h=>{e.push(h)})}return this.findDir(this.dir,e)===void 0?`Directory not found.
`:(this.setCwd(e),`
`)});i(this,"readContent",async t=>await fetch(t).then(async n=>await n.text().then(s=>s.replace(/\r?\n/g,"<br/>").replace(/ /g,"&nbsp;")).catch(s=>s)).catch(n=>n));i(this,"cat",async t=>{if(!t.length)return`Missing filename.
`;let e=this.getCwd();if(t[0].split("/").forEach(s=>{e.push(s)}),this.findDir(this.dir,e)===void 0)return`File not found.
`;const n="/files/"+e.join("/");return await this.readContent(n).then(s=>s).catch(s=>s)+`
`});this.setTerminal(t),this.cwd=[],this.prompt="%",this.commands={help:[this.help,"[command]","help with commands"],ls:[this.ls,"[-l][dir]","list files in directory"],pwd:[this.pwd,"","show current directory"],cd:[this.cd,"[dir]","change directory"],cat:[this.cat,"[filename]","dump a text file"],...f.extensions},this.buffer=this.getPrompt(),this.updatePos(),this.typingBuffer=""}}const x=Object.freeze(Object.defineProperty({__proto__:null,extendCommands:a,terminal:m,terminalStore:f},Symbol.toStringTag,{value:"Module"}));exports.extendCommands=a;exports.terminal=x;exports.terminal$1=m;exports.terminalStore=f;
